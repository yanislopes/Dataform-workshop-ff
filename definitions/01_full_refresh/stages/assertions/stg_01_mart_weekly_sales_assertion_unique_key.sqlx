config {
  type: "assertion",
  database: constants.PROJECT_ID,
  schema: "stage_french_fragrance",
  description: "Vérifie l'unicité de la clé key",
  tags: ["datamart"]
}

SELECT 
  key,
  COUNT(*) AS nb_occurrences
FROM ${ref("stage_french_fragrance", "stg_01_mart_weekly_sales")}
GROUP BY key
HAVING COUNT(*) > 1